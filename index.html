<!-- Updated: August 3, 2025 - All features working! Buttons fixed! -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 50%, #fbbf24 100%);
        }
        .btn-primary {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 8px;
            transition: all 0.3s;
            transform: scale(1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #fce7f3;
            border-radius: 8px;
            outline: none;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.9);
        }
        .input-field:focus {
            ring: 2px;
            ring-color: #ec4899;
            border-color: transparent;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid #fce7f3;
        }
        .recipe-card {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .ingredient-tag {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        .step-number {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Recipe Generator</h1>
            <p class="text-gray-600">Enter your ingredients and get delicious recipes!</p>
            
            <!-- Premium Banner -->
            <div id="premium-banner" class="card p-4 mt-4 bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-200">
                <div class="flex items-center justify-center gap-4">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">Upgrade to Premium</h3>
                        <p class="text-sm text-gray-600">Unlock advanced features and unlimited recipes!</p>
                    </div>
                    <button onclick="showPremiumModal()" class="btn-primary px-4 py-2 text-sm">
                        Upgrade Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Input Form -->
        <div class="card p-6 mb-6">
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Ingredients:</label>
                <div id="ingredients-container">
                    <div class="flex gap-2 mb-2">
                        <input type="text" class="input-field flex-1" placeholder="Enter an ingredient..." id="ingredient-0">
                        <button onclick="addIngredient()" class="btn-primary">+</button>
                        <button onclick="removeIngredient(this)" class="btn-primary">-</button>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Dietary Restrictions:</label>
                <div class="flex flex-wrap gap-2">
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="vegetarian"> Vegetarian
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="vegan"> Vegan
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="gluten-free"> Gluten-Free
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="dairy-free"> Dairy-Free
                    </label>
                </div>
            </div>

            <button onclick="generateRecipe()" class="btn-primary w-full py-3">
                Generate Recipe
            </button>
        </div>

        <!-- Recipe Display -->
        <div id="recipe-display" class="hidden">
            <div class="card p-8 recipe-card">
                <h2 id="recipe-title" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                <p id="recipe-description" class="text-gray-600 mb-6"></p>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Ingredients:</h3>
                        <ul id="recipe-ingredients" class="space-y-2"></ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Instructions:</h3>
                        <ol id="recipe-instructions" class="space-y-3"></ol>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-6">
                    <div class="flex items-center">
                        <span class="font-semibold">‚è±Ô∏è Cooking Time:</span>
                        <span id="cooking-time" class="ml-2"></span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-semibold">üë• Servings:</span>
                        <span id="servings" class="ml-2"></span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-semibold">üî• Calories:</span>
                        <span id="calories" class="ml-2"></span>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex gap-4 mb-6">
                    <button onclick="reloadRecipe()" class="btn-primary px-6 py-2">
                        üîÑ Reload Recipe
                    </button>
                    <button onclick="addToShoppingList()" class="btn-primary px-6 py-2">
                        üõí Add to Shopping List
                    </button>
                </div>
                
                <!-- Premium Features (shown after recipe creation) -->
                <div id="premium-features-after-recipe" class="hidden">
                    <div class="border-t pt-6 mt-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Premium Features</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">Servings (Premium):</label>
                                <select id="servings-select" onchange="updateServings(this.value)" class="input-field">
                                    <option value="2">2 servings</option>
                                    <option value="4" selected>4 servings</option>
                                    <option value="6">6 servings</option>
                                    <option value="8">8 servings</option>
                                    <option value="10">10 servings</option>
                                    <option value="12">12 servings</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">Cooking Time (Premium):</label>
                                <select id="time-select" onchange="updateCookingTime(this.value)" class="input-field">
                                    <option value="any">Any time</option>
                                    <option value="quick">Quick (15 min or less)</option>
                                    <option value="medium">Medium (15-30 min)</option>
                                    <option value="slow">Slow (30+ min)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">Cuisine Style (Premium):</label>
                                <select id="cuisine-select" onchange="updateCuisine(this.value)" class="input-field">
                                    <option value="any">Any cuisine</option>
                                    <option value="italian">Italian</option>
                                    <option value="asian">Asian</option>
                                    <option value="mexican">Mexican</option>
                                    <option value="mediterranean">Mediterranean</option>
                                    <option value="indian">Indian</option>
                                    <option value="american">American</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">Difficulty Level (Premium):</label>
                                <select id="difficulty-select" onchange="updateDifficulty(this.value)" class="input-field">
                                    <option value="any">Any difficulty</option>
                                    <option value="easy">Easy (Beginner)</option>
                                    <option value="medium">Medium (Intermediate)</option>
                                    <option value="hard">Hard (Advanced)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Premium Modal -->
        <div id="premium-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Premium Features</h2>
                    <button onclick="hidePremiumModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                
                <!-- Premium Plans -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="border-2 border-gray-200 rounded-lg p-6 hover:border-pink-300 transition-colors">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Monthly Plan</h3>
                        <div class="text-3xl font-bold text-pink-500 mb-2">$9.99<span class="text-lg text-gray-500">/month</span></div>
                        <ul class="space-y-2 text-gray-600 mb-4">
                            <li>‚úì Unlimited recipe generation</li>
                            <li>‚úì Advanced dietary filters</li>
                            <li>‚úì Recipe scaling (2-12 servings)</li>
                            <li>‚úì Nutritional information</li>
                            <li>‚úì Recipe collections</li>
                            <li>‚úì Ad-free experience</li>
                        </ul>
                        <button onclick="selectPlan('monthly')" class="btn-primary w-full">Choose Monthly</button>
                    </div>
                    
                    <div class="border-2 border-pink-300 rounded-lg p-6 bg-pink-50 relative">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-pink-500 text-white px-4 py-1 rounded-full text-sm font-bold">BEST VALUE</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Yearly Plan</h3>
                        <div class="text-3xl font-bold text-pink-500 mb-2">$79.99<span class="text-lg text-gray-500">/year</span></div>
                        <div class="text-sm text-green-600 mb-2">Save 33% compared to monthly!</div>
                        <ul class="space-y-2 text-gray-600 mb-4">
                            <li>‚úì Everything in Monthly</li>
                            <li>‚úì Meal planning tools</li>
                            <li>‚úì Shopping list generator</li>
                            <li>‚úì Recipe sharing</li>
                            <li>‚úì Priority support</li>
                            <li>‚úì Early access to new features</li>
                        </ul>
                        <button onclick="selectPlan('yearly')" class="btn-primary w-full">Choose Yearly</button>
                    </div>
                </div>
                
                <!-- Payment Form -->
                <div id="payment-form" class="hidden">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Payment Information</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Email Address</label>
                            <input type="email" id="customer-email" class="input-field" placeholder="your@email.com" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Postal Code</label>
                            <input type="text" id="postal-code" class="input-field" placeholder="12345" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 font-semibold mb-2">Card Details</label>
                            <div id="card-element" class="input-field" style="padding: 12px 16px; min-height: 40px;"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="text-lg font-bold text-gray-800">
                            Total: <span id="plan-price">$9.99</span>
                        </div>
                        <button onclick="processPayment()" class="btn-primary px-8 py-3">
                            Pay Now
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reset App Link -->
        <div class="text-center mt-8">
            <button onclick="resetApp()" class="text-sm text-gray-500 hover:text-gray-700 underline">
                Reset App (Clear All Data)
            </button>
        </div>
    </div>

    <script>
        let ingredientCount = 1;
        let isPremium = false;
        let selectedPlan = '';
        let servings = 4;

        // Check if user is premium on page load
        window.addEventListener('load', function() {
            // Check if premium status is stored
            const premiumStatus = localStorage.getItem('isPremium');
            if (premiumStatus === 'true') {
                isPremium = true;
                // Hide the premium banner and show premium features
                const banner = document.getElementById('premium-banner');
                if (banner) {
                    banner.classList.add('hidden');
                }
                // Add premium features to the form
                addPremiumFeatures();
            }
        });

        function addIngredient() {
            const container = document.getElementById('ingredients-container');
            const newDiv = document.createElement('div');
            newDiv.className = 'flex gap-2 mb-2';
            newDiv.innerHTML = `
                <input type="text" class="input-field flex-1" placeholder="Enter an ingredient..." id="ingredient-${ingredientCount}">
                <button onclick="addIngredient()" class="btn-primary">+</button>
                <button onclick="removeIngredient(this)" class="btn-primary">-</button>
            `;
            container.appendChild(newDiv);
            ingredientCount++;
        }

        function removeIngredient(button) {
            button.parentElement.remove();
        }

        function reloadRecipe() {
            if (window.currentIngredients && window.currentRestrictions) {
                const recipe = generateRecipeFromIngredients(window.currentIngredients, window.currentRestrictions);
                displayRecipe(recipe);
            } else {
                alert('No previous recipe to reload. Generate a recipe first!');
            }
        }

        function generateRecipe() {
            const ingredients = [];
            for (let i = 0; i < ingredientCount; i++) {
                const input = document.getElementById(`ingredient-${i}`);
                if (input && input.value.trim()) {
                    ingredients.push(input.value.trim());
                }
            }

            if (ingredients.length === 0) {
                alert('Please add at least one ingredient!');
                return;
            }

            // Get dietary restrictions
            const restrictions = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                restrictions.push(cb.value);
            });

            // Store current ingredients and restrictions for reload
            window.currentIngredients = ingredients;
            window.currentRestrictions = restrictions;

            // Generate recipe based on ingredients
            const recipe = generateRecipeFromIngredients(ingredients, restrictions);
            displayRecipe(recipe);
            
            // Show premium features after recipe creation
            if (isPremium) {
                document.getElementById('premium-features-after-recipe').classList.remove('hidden');
            }
        }

        const recipes = {
            

        function generateRecipeFromIngredients(ingredients, restrictions) {
            // Filter recipes based on dietary restrictions
            let availableRecipes = Object.keys(recipes);
            
            if (restrictions.includes('vegetarian')) {
                availableRecipes = availableRecipes.filter(recipe => 
                    !['beef', 'chicken', 'salmon'].includes(recipe)
                );
            }
            
            if (restrictions.includes('vegan')) {
                availableRecipes = availableRecipes.filter(recipe => 
                    !['beef', 'chicken', 'salmon', 'pasta'].includes(recipe)
                );
            }
            
            if (restrictions.includes('gluten-free')) {
                availableRecipes = availableRecipes.filter(recipe => 
                    !['pasta', 'bread'].includes(recipe)
                );
            }
            
            if (restrictions.includes('dairy-free')) {
                availableRecipes = availableRecipes.filter(recipe => 
                    !['pasta', 'pizza'].includes(recipe)
                );
            }
            
            // If no recipes match restrictions, return a fallback
            if (availableRecipes.length === 0) {
                return {
                    title: 'Custom Vegetable Stir-Fry',
                    description: 'A healthy vegetable stir-fry that meets your dietary requirements',
                    ingredients: ingredients.map(ingredient => ({
                        item: ingredient,
                        amount: '1',
                        unit: 'cup'
                    })),
                    instructions: [
                        'Wash and prepare all vegetables',
                        'Heat oil in a large wok',
                        'Stir-fry vegetables for 5-7 minutes',
                        'Add soy sauce and seasonings',
                        'Serve hot'
                    ],
                    cookingTime: '15 minutes',
                    servings: '4 servings',
                    calories: '180 calories per serving'
                };
            }
            
                        // Select a random recipe from available options
            const selectedRecipe = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
            return recipes[selectedRecipe];
        }
                'chicken': {
                    title: 'Chicken Stir-Fry',
                    description: 'A quick and delicious stir-fry with vegetables and soy sauce',
                    ingredients: [
                        { item: 'chicken breast', amount: '1', unit: 'pound' },
                        { item: 'broccoli', amount: '2', unit: 'cups' },
                        { item: 'soy sauce', amount: '3', unit: 'tablespoons' },
                        { item: 'garlic', amount: '3', unit: 'cloves' },
                        { item: 'ginger', amount: '1', unit: 'tablespoon' }
                    ],
                    instructions: [
                        'Cut chicken into bite-sized pieces',
                        'Heat oil in a large wok or skillet',
                        'Stir-fry chicken until golden brown',
                        'Add garlic and ginger, cook for 1 minute',
                        'Add broccoli and stir-fry for 3 minutes',
                        'Add soy sauce and cook for 2 more minutes',
                        'Serve hot with rice'
                    ],
                    cookingTime: '25 minutes',
                    servings: '4 servings',
                    calories: '285 calories per serving'
                },
                'beef': {
                    title: 'Beef Tacos',
                    description: 'Flavorful ground beef tacos with fresh toppings',
                    ingredients: [
                        { item: 'ground beef (85% lean)', amount: '1', unit: 'pound' },
                        { item: 'taco seasoning', amount: '1', unit: 'packet' },
                        { item: 'corn tortillas', amount: '8', unit: 'pieces' },
                        { item: 'shredded lettuce', amount: '2', unit: 'cups' },
                        { item: 'diced tomatoes', amount: '2', unit: 'medium' },
                        { item: 'shredded cheese', amount: '1', unit: 'cup' },
                        { item: 'sour cream', amount: '1/2', unit: 'cup' }
                    ],
                    instructions: [
                        'Brown ground beef in a large skillet over medium heat',
                        'Drain excess fat and add taco seasoning with 1/2 cup water',
                        'Simmer for 5 minutes until thickened',
                        'Warm tortillas in a dry skillet for 30 seconds each',
                        'Assemble tacos: beef, cheese, lettuce, tomatoes',
                        'Top with sour cream and serve immediately'
                    ],
                    cookingTime: '20 minutes',
                    servings: '4 servings',
                    calories: '425 calories per serving'
                },
                'salmon': {
                    title: 'Baked Salmon',
                    description: 'Simple and healthy baked salmon with herbs',
                    ingredients: [
                        { item: 'salmon fillets (6 oz each)', amount: '4', unit: 'pieces' },
                        { item: 'lemon', amount: '1', unit: 'whole' },
                        { item: 'olive oil', amount: '2', unit: 'tablespoons' },
                        { item: 'fresh dill', amount: '2', unit: 'tablespoons' },
                        { item: 'garlic powder', amount: '1', unit: 'teaspoon' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Preheat oven to 400¬∞F (200¬∞C)',
                        'Line a baking sheet with parchment paper',
                        'Place salmon fillets skin-side down on the sheet',
                        'Drizzle with olive oil and squeeze lemon juice over',
                        'Sprinkle with dill, garlic powder, salt, and pepper',
                        'Bake for 12-15 minutes until flaky',
                        'Serve with steamed vegetables'
                    ],
                    cookingTime: '15 minutes',
                    servings: '4 servings',
                    calories: '320 calories per serving'
                },
                'pasta': {
                    title: 'Creamy Pasta',
                    description: 'Rich and creamy pasta with parmesan cheese',
                    ingredients: [
                        { item: 'fettuccine pasta', amount: '1', unit: 'pound' },
                        { item: 'heavy cream', amount: '1', unit: 'cup' },
                        { item: 'parmesan cheese', amount: '1', unit: 'cup' },
                        { item: 'garlic', amount: '4', unit: 'cloves' },
                        { item: 'butter', amount: '3', unit: 'tablespoons' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Bring a large pot of salted water to boil',
                        'Cook pasta according to package directions (8-10 minutes)',
                        'Meanwhile, melt butter in a large skillet over medium heat',
                        'Add minced garlic and cook for 1 minute until fragrant',
                        'Add cream and simmer for 3 minutes until slightly thickened',
                        'Stir in parmesan cheese until melted and smooth',
                        'Add cooked pasta and toss to coat evenly',
                        'Season with salt and pepper, serve immediately'
                    ],
                    cookingTime: '20 minutes',
                    servings: '4 servings',
                    calories: '580 calories per serving'
                },
                'tomato': {
                    title: 'Fresh Tomato Pasta',
                    description: 'Simple and delicious pasta with fresh tomatoes and basil',
                    ingredients: [
                        { item: 'spaghetti', amount: '1', unit: 'pound' },
                        { item: 'fresh tomatoes', amount: '4', unit: 'large' },
                        { item: 'fresh basil', amount: '1/2', unit: 'cup' },
                        { item: 'garlic', amount: '4', unit: 'cloves' },
                        { item: 'olive oil', amount: '1/4', unit: 'cup' },
                        { item: 'parmesan cheese', amount: '1/2', unit: 'cup' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Bring a large pot of salted water to boil',
                        'Cook spaghetti according to package directions',
                        'Meanwhile, dice tomatoes and mince garlic',
                        'Heat olive oil in a large skillet over medium heat',
                        'Add garlic and cook for 1 minute until fragrant',
                        'Add tomatoes and cook for 5 minutes until softened',
                        'Add cooked pasta and toss with basil',
                        'Top with parmesan cheese and serve'
                    ],
                    cookingTime: '20 minutes',
                    servings: '4 servings',
                    calories: '380 calories per serving'
                },
                'potato': {
                    title: 'Garlic Mashed Potatoes',
                    description: 'Creamy mashed potatoes with roasted garlic',
                    ingredients: [
                        { item: 'potatoes', amount: '3', unit: 'pounds' },
                        { item: 'butter', amount: '1/2', unit: 'cup' },
                        { item: 'milk', amount: '1/2', unit: 'cup' },
                        { item: 'garlic', amount: '6', unit: 'cloves' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Peel and cube potatoes, place in large pot',
                        'Cover with cold water and bring to boil',
                        'Cook for 15-20 minutes until tender',
                        'Meanwhile, roast garlic cloves in foil for 20 minutes',
                        'Drain potatoes and return to pot',
                        'Mash with butter, milk, and roasted garlic',
                        'Season with salt and pepper to taste'
                    ],
                    cookingTime: '30 minutes',
                    servings: '6 servings',
                    calories: '220 calories per serving'
                },
                'egg': {
                    title: 'Scrambled Eggs with Herbs',
                    description: 'Fluffy scrambled eggs with fresh herbs and cheese',
                    ingredients: [
                        { item: 'eggs', amount: '8', unit: 'large' },
                        { item: 'butter', amount: '2', unit: 'tablespoons' },
                        { item: 'milk', amount: '1/4', unit: 'cup' },
                        { item: 'fresh herbs', amount: '2', unit: 'tablespoons' },
                        { item: 'cheddar cheese', amount: '1/2', unit: 'cup' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Crack eggs into a bowl and whisk with milk',
                        'Melt butter in a large skillet over medium-low heat',
                        'Pour in egg mixture and let sit for 30 seconds',
                        'Gently stir with a spatula, folding eggs',
                        'Add herbs and cheese, continue cooking',
                        'Cook until just set but still moist',
                        'Season with salt and pepper, serve immediately'
                    ],
                    cookingTime: '10 minutes',
                    servings: '4 servings',
                    calories: '180 calories per serving'
                },
                'rice': {
                    title: 'Fried Rice',
                    description: 'Classic fried rice with vegetables and soy sauce',
                    ingredients: [
                        { item: 'cooked rice', amount: '4', unit: 'cups' },
                        { item: 'eggs', amount: '3', unit: 'large' },
                        { item: 'mixed vegetables', amount: '2', unit: 'cups' },
                        { item: 'soy sauce', amount: '3', unit: 'tablespoons' },
                        { item: 'sesame oil', amount: '1', unit: 'tablespoon' },
                        { item: 'garlic', amount: '3', unit: 'cloves' },
                        { item: 'green onions', amount: '4', unit: 'pieces' }
                    ],
                    instructions: [
                        'Heat oil in a large wok or skillet over high heat',
                        'Scramble eggs and remove from pan',
                        'Add garlic and vegetables, stir-fry for 2 minutes',
                        'Add rice and break up any clumps',
                        'Add soy sauce and sesame oil',
                        'Return eggs to pan and add green onions',
                        'Stir-fry for 2 more minutes and serve'
                    ],
                    cookingTime: '15 minutes',
                    servings: '4 servings',
                    calories: '320 calories per serving'
                },
                'onion': {
                    title: 'French Onion Soup',
                    description: 'Classic French onion soup with caramelized onions',
                    ingredients: [
                        { item: 'onions', amount: '4', unit: 'large' },
                        { item: 'beef broth', amount: '6', unit: 'cups' },
                        { item: 'butter', amount: '3', unit: 'tablespoons' },
                        { item: 'white wine', amount: '1/2', unit: 'cup' },
                        { item: 'baguette', amount: '1', unit: 'loaf' },
                        { item: 'gruyere cheese', amount: '2', unit: 'cups' },
                        { item: 'thyme', amount: '1', unit: 'teaspoon' }
                    ],
                    instructions: [
                        'Slice onions thinly and melt butter in large pot',
                        'Cook onions over low heat for 45 minutes until caramelized',
                        'Add wine and cook for 2 minutes',
                        'Add broth and thyme, simmer for 30 minutes',
                        'Toast baguette slices under broiler',
                        'Top soup with bread and cheese',
                        'Broil until cheese is melted and bubbly'
                    ],
                    cookingTime: '90 minutes',
                    servings: '4 servings',
                    calories: '420 calories per serving'
                },
                'carrot': {
                    title: 'Honey Glazed Carrots',
                    description: 'Sweet and tender glazed carrots with herbs',
                    ingredients: [
                        { item: 'carrots', amount: '2', unit: 'pounds' },
                        { item: 'honey', amount: '3', unit: 'tablespoons' },
                        { item: 'butter', amount: '2', unit: 'tablespoons' },
                        { item: 'thyme', amount: '1', unit: 'teaspoon' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Peel and slice carrots into uniform pieces',
                        'Melt butter in a large skillet over medium heat',
                        'Add carrots and cook for 5 minutes',
                        'Add honey and thyme, stir to coat',
                        'Cover and cook for 10 minutes until tender',
                        'Season with salt and pepper, serve hot'
                    ],
                    cookingTime: '20 minutes',
                    servings: '4 servings',
                    calories: '140 calories per serving'
                },
                'broccoli': {
                    title: 'Roasted Broccoli with Garlic',
                    description: 'Crispy roasted broccoli with garlic and parmesan',
                    ingredients: [
                        { item: 'broccoli', amount: '2', unit: 'heads' },
                        { item: 'olive oil', amount: '3', unit: 'tablespoons' },
                        { item: 'garlic', amount: '4', unit: 'cloves' },
                        { item: 'parmesan cheese', amount: '1/2', unit: 'cup' },
                        { item: 'lemon', amount: '1', unit: 'whole' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Preheat oven to 425¬∞F (220¬∞C)',
                        'Cut broccoli into florets and mince garlic',
                        'Toss with olive oil, garlic, salt, and pepper',
                        'Spread on baking sheet in single layer',
                        'Roast for 20 minutes until crispy',
                        'Sprinkle with parmesan and lemon zest',
                        'Serve immediately'
                    ],
                    cookingTime: '25 minutes',
                    servings: '4 servings',
                    calories: '120 calories per serving'
                },
                'spinach': {
                    title: 'Creamed Spinach',
                    description: 'Rich and creamy spinach with garlic and cream',
                    ingredients: [
                        { item: 'spinach', amount: '2', unit: 'pounds' },
                        { item: 'heavy cream', amount: '1/2', unit: 'cup' },
                        { item: 'garlic', amount: '3', unit: 'cloves' },
                        { item: 'butter', amount: '2', unit: 'tablespoons' },
                        { item: 'nutmeg', amount: '1/4', unit: 'teaspoon' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Wash spinach thoroughly and remove stems',
                        'Melt butter in large skillet over medium heat',
                        'Add minced garlic and cook for 1 minute',
                        'Add spinach in batches, stirring until wilted',
                        'Add cream and nutmeg, simmer for 3 minutes',
                        'Season with salt and pepper, serve hot'
                    ],
                    cookingTime: '15 minutes',
                    servings: '4 servings',
                    calories: '180 calories per serving'
                },
                'apple': {
                    title: 'Apple Cinnamon Oatmeal',
                    description: 'Warm oatmeal with fresh apples and cinnamon',
                    ingredients: [
                        { item: 'apples', amount: '2', unit: 'medium' },
                        { item: 'oats', amount: '2', unit: 'cups' },
                        { item: 'milk', amount: '4', unit: 'cups' },
                        { item: 'cinnamon', amount: '1', unit: 'teaspoon' },
                        { item: 'honey', amount: '2', unit: 'tablespoons' },
                        { item: 'vanilla', amount: '1', unit: 'teaspoon' }
                    ],
                    instructions: [
                        'Dice apples and set aside',
                        'Bring milk to boil in large saucepan',
                        'Add oats and reduce heat to simmer',
                        'Cook for 5 minutes, stirring occasionally',
                        'Add diced apples, cinnamon, and honey',
                        'Cook for 2 more minutes until apples are tender',
                        'Stir in vanilla and serve hot'
                    ],
                    cookingTime: '15 minutes',
                    servings: '4 servings',
                    calories: '220 calories per serving'
                },
                'banana': {
                    title: 'Banana Bread',
                    description: 'Moist and delicious banana bread with walnuts',
                    ingredients: [
                        { item: 'bananas', amount: '3', unit: 'ripe' },
                        { item: 'flour', amount: '2', unit: 'cups' },
                        { item: 'sugar', amount: '1', unit: 'cup' },
                        { item: 'eggs', amount: '2', unit: 'large' },
                        { item: 'butter', amount: '1/2', unit: 'cup' },
                        { item: 'walnuts', amount: '1/2', unit: 'cup' },
                        { item: 'vanilla', amount: '1', unit: 'teaspoon' }
                    ],
                    instructions: [
                        'Preheat oven to 350¬∞F (175¬∞C)',
                        'Mash bananas in a large bowl',
                        'Cream butter and sugar until fluffy',
                        'Add eggs and vanilla, mix well',
                        'Stir in mashed bananas',
                        'Fold in flour and chopped walnuts',
                        'Pour into greased loaf pan and bake for 60 minutes'
                    ],
                    cookingTime: '60 minutes',
                    servings: '8 servings',
                    calories: '280 calories per serving'
                },
                'mushroom': {
                    title: 'Garlic Mushroom Pasta',
                    description: 'Creamy pasta with saut√©ed mushrooms and garlic',
                    ingredients: [
                        { item: 'mushrooms', amount: '1', unit: 'pound' },
                        { item: 'linguine', amount: '1', unit: 'pound' },
                        { item: 'garlic', amount: '4', unit: 'cloves' },
                        { item: 'butter', amount: '3', unit: 'tablespoons' },
                        { item: 'parmesan cheese', amount: '1', unit: 'cup' },
                        { item: 'parsley', amount: '1/4', unit: 'cup' },
                        { item: 'salt and pepper', amount: 'to taste', unit: '' }
                    ],
                    instructions: [
                        'Cook pasta according to package directions',
                        'Slice mushrooms and mince garlic',
                        'Melt butter in large skillet over medium heat',
                        'Add mushrooms and cook for 5 minutes',
                        'Add garlic and cook for 1 minute',
                        'Add cooked pasta and parmesan',
                        'Toss with parsley and season to taste'
                    ],
                    cookingTime: '20 minutes',
                    servings: '4 servings',
                    calories: '420 calories per serving'
                },
                'cheese': {
                    title: 'Grilled Cheese with Tomato Soup',
                    description: 'Classic grilled cheese with homemade tomato soup',
                    ingredients: [
                        { item: 'bread', amount: '8', unit: 'slices' },
                        { item: 'cheddar cheese', amount: '1', unit: 'pound' },
                        { item: 'butter', amount: '4', unit: 'tablespoons' },
                        { item: 'tomatoes', amount: '4', unit: 'large' },
                        { item: 'onion', amount: '1', unit: 'medium' },
                        { item: 'garlic', amount: '2', unit: 'cloves' },
                        { item: 'cream', amount: '1/2', unit: 'cup' }
                    ],
                    instructions: [
                        'Make soup: saut√© onion and garlic in oil',
                        'Add chopped tomatoes and simmer for 20 minutes',
                        'Blend until smooth and add cream',
                        'For sandwiches: butter bread and add cheese',
                        'Grill in skillet until golden and cheese melts',
                        'Serve hot sandwiches with warm soup'
                    ],
                    cookingTime: '30 minutes',
                    servings: '4 servings',
                    calories: '450 calories per serving'
                }
            };

            // Try to find a matching recipe with more specific matching
            for (const ingredient of ingredients) {
                const lowerIngredient = ingredient.toLowerCase();
                
                // Check for exact matches first
                if (recipes[lowerIngredient]) {
                    return recipes[lowerIngredient];
                }
                
                // Check for partial matches with more specific logic
                for (const [key, recipe] of Object.entries(recipes)) {
                    if (lowerIngredient.includes(key) && key.length > 2) {
                        return recipe;
                    }
                }
                
                // Check for word-based matches (for complex ingredients)
                const ingredientWords = lowerIngredient.split(' ');
                for (const word of ingredientWords) {
                    if (word.length > 2 && recipes[word]) {
                        return recipes[word];
                    }
                }
            }
            
            // If no specific recipe found, create a multi-ingredient recipe
            if (ingredients.length > 1) {
                return createMultiIngredientRecipe(ingredients, restrictions);
            }

            // Create a simple, universal recipe for any ingredient
            const mainIngredient = ingredients[0];
            const recipeTitle = `${mainIngredient} with Garlic and Herbs`;
            const description = `A delicious and simple way to prepare ${mainIngredient}`;
            const additionalIngredients = [
                { item: mainIngredient, amount: '2', unit: 'cups' },
                { item: 'olive oil', amount: '3', unit: 'tablespoons' },
                { item: 'garlic', amount: '4', unit: 'cloves' },
                { item: 'fresh herbs', amount: '2', unit: 'tablespoons' },
                { item: 'lemon', amount: '1', unit: 'whole' },
                { item: 'butter', amount: '2', unit: 'tablespoons' },
                { item: 'salt and pepper', amount: 'to taste', unit: '' }
            ];
            const instructions = [
                'Heat olive oil and butter in large skillet over medium heat',
                'Add minced garlic and cook for 1 minute until fragrant',
                `Add ${mainIngredient} and cook for 3-4 minutes`,
                'Add fresh herbs and stir to combine',
                'Squeeze lemon juice over and season with salt and pepper',
                'Cook for 2 more minutes until flavors meld',
                'Serve hot as a side dish or over rice'
            ];
            const calories = '180 calories per serving';
            
            return {
                title: recipeTitle,
                description: description,
                ingredients: additionalIngredients,
                instructions: instructions,
                cookingTime: '20 minutes',
                servings: '4 servings',
                calories: calories
            };
        }

        function displayRecipe(recipe) {
            document.getElementById('recipe-title').textContent = recipe.title;
            document.getElementById('recipe-description').textContent = recipe.description;
            
            // Display ingredients (scale for premium users)
            const ingredientsList = document.getElementById('recipe-ingredients');
            ingredientsList.innerHTML = '';
            recipe.ingredients.forEach(ingredient => {
                const li = document.createElement('li');
                li.className = 'flex items-center';
                let amount = ingredient.amount;
                let unit = ingredient.unit;
                
                // Scale ingredients for premium users
                if (isPremium && servings !== 4) {
                    const originalAmount = parseFloat(amount);
                    const scaleFactor = servings / 4;
                    amount = (originalAmount * scaleFactor).toFixed(1);
                    if (amount.endsWith('.0')) amount = amount.slice(0, -2);
                }
                
                li.innerHTML = `
                    <span class="ingredient-tag mr-2">${amount} ${unit}</span>
                    <span class="text-gray-700">${ingredient.item}</span>
                `;
                ingredientsList.appendChild(li);
            });

            // Display instructions
            const instructionsList = document.getElementById('recipe-instructions');
            instructionsList.innerHTML = '';
            recipe.instructions.forEach((instruction, index) => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-3';
                li.innerHTML = `
                    <div class="step-number">${index + 1}</div>
                    <span class="text-gray-700">${instruction}</span>
                `;
                instructionsList.appendChild(li);
            });

            // Display cooking info
            document.getElementById('cooking-time').textContent = recipe.cookingTime;
            document.getElementById('servings').textContent = isPremium ? `${servings} servings` : recipe.servings;
            document.getElementById('calories').textContent = recipe.calories;

            // Show the recipe
            document.getElementById('recipe-display').classList.remove('hidden');
            document.getElementById('recipe-display').scrollIntoView({ behavior: 'smooth' });
        }

        // Premium Functions
        function showPremiumModal() {
            const modal = document.getElementById('premium-modal');
            const premiumStatus = document.getElementById('premium-status');
            const premiumPlans = document.querySelector('.grid.md\\:grid-cols-2');
            
            modal.classList.remove('hidden');
            
            // Show different content based on premium status
            if (isPremium) {
                premiumStatus.classList.remove('hidden');
                premiumPlans.classList.add('hidden');
            } else {
                premiumStatus.classList.add('hidden');
                premiumPlans.classList.remove('hidden');
            }
        }

        function hidePremiumModal() {
            document.getElementById('premium-modal').classList.add('hidden');
            document.getElementById('payment-form').classList.add('hidden');
        }

        function cancelPremium() {
            if (confirm('Are you sure you want to cancel your premium subscription? You will lose access to all premium features.')) {
                // Remove premium status
                isPremium = false;
                localStorage.removeItem('isPremium');
                
                // Hide premium modal
                hidePremiumModal();
                
                // Reload the page to show non-premium version
                location.reload();
                
                alert('Premium subscription cancelled. You are now on the free plan.');
            }
        }

        function resetApp() {
            if (confirm('Are you sure you want to reset the app? This will clear all data including premium status, saved recipes, and history.')) {
                // Clear all localStorage data
                localStorage.clear();
                
                // Reset variables
                isPremium = false;
                ingredientCount = 1;
                servings = 4;
                
                // Reload the page
                location.reload();
                
                alert('App reset successfully! All data has been cleared.');
            }
        }

        function viewFullRecipeByIndex(index) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            // Sort recipes by save date (newest first) to match the display order
            savedRecipes.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
            const recipe = savedRecipes[index];
            
            if (!recipe) {
                alert('Recipe not found!');
                return;
            }
            
            // Display the full recipe
            displayRecipe(recipe);
            
            // Go back to main page to show the recipe
            showMainPage();
        }

        function addToShoppingListByIndex(index) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            // Sort recipes by save date (newest first) to match the display order
            savedRecipes.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
            const recipe = savedRecipes[index];
            
            if (!recipe) {
                alert('Recipe not found!');
                return;
            }
            
            const shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            
            // Add all ingredients from the recipe
            recipe.ingredients.forEach(ingredient => {
                // Check if ingredient already exists
                const existingIndex = shoppingList.findIndex(item => 
                    item.item.toLowerCase() === ingredient.item.toLowerCase()
                );
                
                if (existingIndex !== -1) {
                    // Update quantity if ingredient exists
                    const existing = shoppingList[existingIndex];
                    const existingAmount = parseFloat(existing.amount);
                    const newAmount = parseFloat(ingredient.amount);
                    shoppingList[existingIndex].amount = (existingAmount + newAmount).toString();
                } else {
                    // Add new ingredient
                    shoppingList.push({
                        item: ingredient.item,
                        amount: ingredient.amount,
                        unit: ingredient.unit,
                        fromRecipe: recipe.title
                    });
                }
            });
            
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            alert(`Added ${recipe.ingredients.length} ingredients from "${recipe.title}" to your shopping list!`);
        }

        function deleteSavedRecipeByIndex(index) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            // Sort recipes by save date (newest first) to match the display order
            savedRecipes.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
            const recipe = savedRecipes[index];
            
            if (!recipe) {
                alert('Recipe not found!');
                return;
            }
            
            if (confirm(`Are you sure you want to delete "${recipe.title}" from your saved recipes?`)) {
                // Find the original index in the unsorted array
                const originalRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
                const originalIndex = originalRecipes.findIndex(r => r.title === recipe.title);
                
                if (originalIndex !== -1) {
                    originalRecipes.splice(originalIndex, 1);
                    localStorage.setItem('savedRecipes', JSON.stringify(originalRecipes));
                    
                    // Refresh the saved recipes page
                    showSavedRecipesPage();
                    
                    alert('Recipe deleted successfully!');
                }
            }
        }

        function viewFullRecipeByIndex(index) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            // Sort recipes by save date (newest first) to match the display order
            savedRecipes.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
            const recipe = savedRecipes[index];
            
            if (!recipe) {
                alert('Recipe not found!');
                return;
            }
            
            // Display the full recipe
            displayRecipe(recipe);
            
            // Go back to main page to show the recipe
            showMainPage();
        }

        function addToShoppingListByIndex(index) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            // Sort recipes by save date (newest first) to match the display order
            savedRecipes.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
            const recipe = savedRecipes[index];
            
            if (!recipe) {
                alert('Recipe not found!');
                return;
            }
            
            const shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            
            // Add all ingredients from the recipe
            recipe.ingredients.forEach(ingredient => {
                // Check if ingredient already exists
                const existingIndex = shoppingList.findIndex(item => 
                    item.item.toLowerCase() === ingredient.item.toLowerCase()
                );
                
                if (existingIndex !== -1) {
                    // Update quantity if ingredient exists
                    const existing = shoppingList[existingIndex];
                    const existingAmount = parseFloat(existing.amount);
                    const newAmount = parseFloat(ingredient.amount);
                    shoppingList[existingIndex].amount = (existingAmount + newAmount).toString();
                } else {
                    // Add new ingredient
                    shoppingList.push({
                        item: ingredient.item,
                        amount: ingredient.amount,
                        unit: ingredient.unit,
                        fromRecipe: recipe.title
                    });
                }
            });
            
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            alert(`Added ${recipe.ingredients.length} ingredients from "${recipe.title}" to your shopping list!`);
        }

        function selectPlan(plan) {
            selectedPlan = plan;
            const price = plan === 'monthly' ? '$9.99' : '$79.99';
            document.getElementById('plan-price').textContent = price;
            
            // Hide plan selection and show payment form with animation
            document.querySelector('.grid.md\\:grid-cols-2').classList.add('hidden');
            document.getElementById('payment-form').classList.remove('hidden');
            document.getElementById('payment-form').style.animation = 'slideIn 0.5s ease-out';
            
            // Initialize Stripe when payment form is shown
            if (!stripe) {
                initializeStripe();
            }
        }

        // Stripe initialization
        let stripe;
        let cardElement;

        function initializeStripe() {
            stripe = Stripe('pk_live_51QGR3EDYRm11DoRiF412084WDjELauYMAvVDQ3W1pHL05fLavgUQeUm9MwrtDhRLEeRTB3NfnqHAwHtt2vf0MTVp00QRkSfv5x');
            
            const elements = stripe.elements();
            cardElement = elements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#424770',
                        '::placeholder': {
                            color: '#aab7c4',
                        },
                    },
                    invalid: {
                        color: '#9e2146',
                    },
                },
            });
            
            cardElement.mount('#card-element');
        }

        function processPayment() {
            const email = document.getElementById('customer-email').value;

            if (!email) {
                alert('Please enter your email address');
                return;
            }

            if (!stripe || !cardElement) {
                alert('Payment system not initialized. Please try again.');
                return;
            }

            // Show loading state
            const payButton = document.querySelector('button[onclick="processPayment()"]');
            const originalText = payButton.textContent;
            payButton.textContent = 'Processing...';
            payButton.disabled = true;

            // Create payment method with Stripe Elements
            stripe.createPaymentMethod({
                type: 'card',
                card: cardElement,
                billing_details: {
                    email: email,
                    address: {
                        postal_code: document.getElementById('postal-code').value
                    }
                },
            }).then(function(result) {
                if (result.error) {
                    throw new Error(result.error.message);
                }
                
                // Send payment method to server
                return fetch('http://localhost:3001/api/create-subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        plan: selectedPlan,
                        paymentMethodId: result.paymentMethod.id
                    })
                });
            }).then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Payment response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Payment successful
                isPremium = true;
                localStorage.setItem('isPremium', 'true');
                localStorage.setItem('subscriptionId', data.subscriptionId);
                localStorage.setItem('customerId', data.customerId);
                
                console.log('Setting premium status to true');
                hidePremiumModal();
                document.getElementById('premium-banner').classList.add('hidden');
                addPremiumFeatures();
                
                alert('Payment successful! Welcome to Premium!');
            })
            .catch(error => {
                console.error('Payment error:', error);
                alert('Payment failed: ' + error.message);
                
                // Reset payment form on error
                payButton.textContent = originalText;
                payButton.disabled = false;
            })
            .finally(() => {
                payButton.textContent = originalText;
                payButton.disabled = false;
            });
        }

        function addPremiumFeatures() {
            console.log('Adding premium features...');
            const form = document.querySelector('.card.p-6.mb-6');
            
            if (!form) {
                console.error('Could not find form element');
                return;
            }
            
            // Add servings selector
            const servingsDiv = document.createElement('div');
            servingsDiv.className = 'mb-4';
            servingsDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Servings (Premium):</label>
                <select id="servings-select" onchange="updateServings(this.value)" class="input-field">
                    <option value="2">2 servings</option>
                    <option value="4" selected>4 servings</option>
                    <option value="6">6 servings</option>
                    <option value="8">8 servings</option>
                    <option value="10">10 servings</option>
                    <option value="12">12 servings</option>
                </select>
            `;
            
            // Add cooking time preference
            const timeDiv = document.createElement('div');
            timeDiv.className = 'mb-4';
            timeDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Cooking Time (Premium):</label>
                <select id="time-select" onchange="updateCookingTime(this.value)" class="input-field">
                    <option value="any">Any time</option>
                    <option value="quick">Quick (15 min or less)</option>
                    <option value="medium">Medium (15-30 min)</option>
                    <option value="slow">Slow (30+ min)</option>
                </select>
            `;
            
            // Add cuisine preference
            const cuisineDiv = document.createElement('div');
            cuisineDiv.className = 'mb-4';
            cuisineDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Cuisine Style (Premium):</label>
                <select id="cuisine-select" onchange="updateCuisine(this.value)" class="input-field">
                    <option value="any">Any cuisine</option>
                    <option value="italian">Italian</option>
                    <option value="asian">Asian</option>
                    <option value="mexican">Mexican</option>
                    <option value="mediterranean">Mediterranean</option>
                    <option value="indian">Indian</option>
                    <option value="american">American</option>
                </select>
            `;
            
            // Add difficulty level
            const difficultyDiv = document.createElement('div');
            difficultyDiv.className = 'mb-4';
            difficultyDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Difficulty Level (Premium):</label>
                <select id="difficulty-select" onchange="updateDifficulty(this.value)" class="input-field">
                    <option value="any">Any difficulty</option>
                    <option value="easy">Easy (Beginner)</option>
                    <option value="medium">Medium (Intermediate)</option>
                    <option value="hard">Hard (Advanced)</option>
                </select>
            `;
            
            // Add meal planning section
            const mealPlanDiv = document.createElement('div');
            mealPlanDiv.className = 'mb-4';
            mealPlanDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Meal Planning (Premium):</label>
                <div class="flex gap-2">
                    <button onclick="addToMealPlan('breakfast')" class="btn-primary text-sm px-3 py-1">Breakfast</button>
                    <button onclick="addToMealPlan('lunch')" class="btn-primary text-sm px-3 py-1">Lunch</button>
                    <button onclick="addToMealPlan('dinner')" class="btn-primary text-sm px-3 py-1">Dinner</button>
                    <button onclick="addToMealPlan('snack')" class="btn-primary text-sm px-3 py-1">Snack</button>
                </div>
            `;
            
            // Add recipe collections
            const collectionsDiv = document.createElement('div');
            collectionsDiv.className = 'mb-4';
            collectionsDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Recipe Collections (Premium):</label>
                <div class="flex gap-2">
                    <button onclick="navigateToPage('saved-recipes')" class="btn-primary text-sm px-3 py-1">Saved Recipes</button>
                    <button onclick="navigateToPage('shopping-list')" class="btn-primary text-sm px-3 py-1">Shopping List</button>
                    <button onclick="navigateToPage('meal-plan')" class="btn-primary text-sm px-3 py-1">Meal Plan</button>
                </div>
            `;
            
            // Add cooking tips and substitutions
            const tipsDiv = document.createElement('div');
            tipsDiv.className = 'mb-4';
            tipsDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Smart Features (Premium):</label>
                <div class="flex gap-2">
                    <button onclick="navigateToPage('cooking-tips')" class="btn-primary text-sm px-3 py-1">Cooking Tips</button>
                    <button onclick="navigateToPage('substitutions')" class="btn-primary text-sm px-3 py-1">Substitutions</button>
                    <button onclick="navigateToPage('wine-pairing')" class="btn-primary text-sm px-3 py-1">Wine Pairing</button>
                </div>
            `;
            
            // Add recipe rating and reviews
            const ratingDiv = document.createElement('div');
            ratingDiv.className = 'mb-4';
            ratingDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Recipe Rating (Premium):</label>
                <div class="flex gap-2">
                    <button onclick="rateRecipe(5)" class="text-2xl">‚òÖ</button>
                    <button onclick="rateRecipe(4)" class="text-2xl">‚òÖ</button>
                    <button onclick="rateRecipe(3)" class="text-2xl">‚òÖ</button>
                    <button onclick="rateRecipe(2)" class="text-2xl">‚òÖ</button>
                    <button onclick="rateRecipe(1)" class="text-2xl">‚òÖ</button>
                </div>
            `;
            
            // Add cooking timer and modes
            const timerDiv = document.createElement('div');
            timerDiv.className = 'mb-4';
            timerDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Cooking Timer (Premium):</label>
                <div class="flex gap-2">
                    <button onclick="startTimer(5)" class="btn-primary text-sm px-3 py-1">5 min</button>
                    <button onclick="startTimer(10)" class="btn-primary text-sm px-3 py-1">10 min</button>
                    <button onclick="startTimer(15)" class="btn-primary text-sm px-3 py-1">15 min</button>
                    <button onclick="startTimer(30)" class="btn-primary text-sm px-3 py-1">30 min</button>
                    <button onclick="customTimer()" class="btn-primary text-sm px-3 py-1">Custom</button>
                </div>
            `;
            
            // Add recipe history and favorites
            const historyDiv = document.createElement('div');
            historyDiv.className = 'mb-4';
            historyDiv.innerHTML = `
                <label class="block text-gray-700 font-semibold mb-2">Recipe History (Premium):</label>
                <div class="flex gap-2">
                    <button onclick="navigateToPage('recipe-history')" class="btn-primary text-sm px-3 py-1">History</button>
                    <button onclick="navigateToPage('favorites')" class="btn-primary text-sm px-3 py-1">Favorites</button>
                    <button onclick="navigateToPage('timer')" class="btn-primary text-sm px-3 py-1">Timer</button>
                </div>
            `;
            
            // Insert after dietary restrictions
            const dietaryDiv = form.querySelector('.mb-4:last-of-type');
            dietaryDiv.parentNode.insertBefore(servingsDiv, dietaryDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(timeDiv, servingsDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(cuisineDiv, timeDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(difficultyDiv, cuisineDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(mealPlanDiv, difficultyDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(collectionsDiv, mealPlanDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(tipsDiv, collectionsDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(ratingDiv, tipsDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(timerDiv, ratingDiv.nextSibling);
            dietaryDiv.parentNode.insertBefore(historyDiv, timerDiv.nextSibling);
        }

        // Timer functions
        let activeTimer = null;
        
        function startTimer(minutes) {
            if (activeTimer) {
                clearInterval(activeTimer);
            }
            
            let timeLeft = minutes * 60;
            const timerDisplay = document.createElement('div');
            timerDisplay.id = 'timer-display';
            timerDisplay.className = 'fixed top-4 right-4 bg-pink-500 text-white p-4 rounded-lg shadow-lg z-50';
            timerDisplay.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl font-bold">‚è∞ Cooking Timer</div>
                    <div id="timer-time" class="text-3xl font-bold">${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}</div>
                    <button onclick="stopTimer()" class="btn-primary mt-2 text-sm">Stop Timer</button>
                </div>
            `;
            
            document.body.appendChild(timerDisplay);
            
            activeTimer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft/60);
                const seconds = timeLeft%60;
                document.getElementById('timer-time').textContent = `${minutes}:${seconds.toString().padStart(2,'0')}`;
                
                if (timeLeft <= 0) {
                    stopTimer();
                    alert('‚è∞ Timer finished! Your food is ready!');
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (activeTimer) {
                clearInterval(activeTimer);
                activeTimer = null;
            }
            const timerDisplay = document.getElementById('timer-display');
            if (timerDisplay) {
                timerDisplay.remove();
            }
        }
        
        function customTimer() {
            const minutes = prompt('Enter timer duration in minutes:');
            if (minutes && !isNaN(minutes)) {
                startTimer(parseInt(minutes));
            }
        }

        // Recipe history functions
        function viewRecipeHistory() {
            const history = JSON.parse(localStorage.getItem('recipeHistory') || '[]');
            if (history.length === 0) {
                alert('No recipe history yet! Generate recipes to see them here.');
                return;
            }
            
            let historyText = 'üìö Recipe History:\n\n';
            history.slice(-10).reverse().forEach((recipe, index) => {
                const date = new Date(recipe.date).toLocaleDateString();
                historyText += `${index + 1}. ${recipe.title} (${date})\n`;
            });
            
            alert(historyText);
        }
        
        function viewFavorites() {
            const favorites = JSON.parse(localStorage.getItem('recipeFavorites') || '[]');
            if (favorites.length === 0) {
                alert('No favorite recipes yet! Rate recipes 5 stars to add them to favorites.');
                return;
            }
            
            let favoritesText = '‚≠ê Favorite Recipes:\n\n';
            favorites.forEach((recipe, index) => {
                favoritesText += `${index + 1}. ${recipe.title} (${recipe.rating}‚≠ê)\n`;
            });
            
            alert(favoritesText);
        }
        
        function clearHistory() {
            if (confirm('Are you sure you want to clear all recipe history?')) {
                localStorage.removeItem('recipeHistory');
                localStorage.removeItem('recipeFavorites');
                alert('Recipe history cleared!');
            }
        }

        // Navigation system
        function navigateToPage(page) {
            const mainContent = document.querySelector('.container');
            
            switch(page) {
                case 'cooking-tips':
                    showCookingTipsPage();
                    break;
                case 'substitutions':
                    showSubstitutionsPage();
                    break;
                case 'wine-pairing':
                    showWinePairingPage();
                    break;
                case 'saved-recipes':
                    showSavedRecipesPage();
                    break;
                case 'shopping-list':
                    showShoppingListPage();
                    break;
                case 'meal-plan':
                    showMealPlanPage();
                    break;
                case 'recipe-history':
                    showRecipeHistoryPage();
                    break;
                case 'favorites':
                    showFavoritesPage();
                    break;
                case 'timer':
                    showTimerPage();
                    break;
            }
        }

        function showCookingTipsPage() {
            const mainContent = document.querySelector('.container');
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">üí° Cooking Tips</h1>
                    <p class="text-gray-600">Professional cooking tips to improve your skills!</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üî™ Knife Skills</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li>‚Ä¢ Always sharpen your knives before cooking</li>
                            <li>‚Ä¢ Use a claw grip to protect your fingers</li>
                            <li>‚Ä¢ Keep your knife at a 20-degree angle</li>
                            <li>‚Ä¢ Use a cutting board with a damp towel underneath</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üå°Ô∏è Temperature Control</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li>‚Ä¢ Let meat rest for 5-10 minutes after cooking</li>
                            <li>‚Ä¢ Use a meat thermometer for perfect doneness</li>
                            <li>‚Ä¢ Preheat your pan before adding ingredients</li>
                            <li>‚Ä¢ Test oil temperature with a drop of water</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üßÇ Seasoning</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li>‚Ä¢ Season in layers throughout cooking</li>
                            <li>‚Ä¢ Taste as you cook and adjust gradually</li>
                            <li>‚Ä¢ Salt draws out moisture, so add early</li>
                            <li>‚Ä¢ Fresh herbs go in at the end</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">ü•ò Equipment</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li>‚Ä¢ Use wooden spoons for non-stick pans</li>
                            <li>‚Ä¢ Keep a bowl of water nearby for testing</li>
                            <li>‚Ä¢ Use the right pan size for your ingredients</li>
                            <li>‚Ä¢ Clean as you go to stay organized</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function showSubstitutionsPage() {
            currentPage = 'substitutions';
            const mainContent = document.querySelector('.container');
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Ingredient Substitutions</h1>
                    <p class="text-gray-600">Common ingredient replacements for dietary needs!</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Dairy Substitutions</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>Butter:</strong> Olive oil, coconut oil, applesauce</li>
                            <li><strong>Milk:</strong> Almond, soy, oat, or coconut milk</li>
                            <li><strong>Cream:</strong> Coconut milk, cashew cream</li>
                            <li><strong>Cheese:</strong> Nutritional yeast, vegan cheese</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Egg Substitutions</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>1 Egg:</strong> 1 tbsp flax + 3 tbsp water</li>
                            <li><strong>1 Egg:</strong> 1/4 cup mashed banana</li>
                            <li><strong>1 Egg:</strong> 1/4 cup applesauce</li>
                            <li><strong>1 Egg:</strong> Commercial egg replacer</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Flour Substitutions</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>All-purpose:</strong> Almond flour, coconut flour</li>
                            <li><strong>Gluten-free:</strong> Rice flour, tapioca starch</li>
                            <li><strong>Whole wheat:</strong> Spelt flour, oat flour</li>
                            <li><strong>Bread flour:</strong> All-purpose + vital wheat gluten</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Sweetener Substitutions</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>Sugar:</strong> Honey, maple syrup, stevia</li>
                            <li><strong>Brown sugar:</strong> White sugar + molasses</li>
                            <li><strong>Powdered sugar:</strong> Blend granulated sugar</li>
                            <li><strong>Corn syrup:</strong> Honey, agave nectar</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        let currentPage = 'main';
        let previousPage = 'main';

        function goBack() {
            if (currentPage === 'main') {
                // If we're on the main page, reload to get back to premium state
                location.reload();
            } else {
                // If we're on a premium page, go back to the main page with premium features
                showMainPage();
            }
        }

        function showMainPage() {
            currentPage = 'main';
            // Instead of reloading, restore the premium state
            if (isPremium) {
                // Recreate the main page with premium features
                const mainContent = document.querySelector('.container');
                mainContent.innerHTML = `
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">Recipe Generator</h1>
                        <p class="text-gray-600">Enter your ingredients and get delicious recipes!</p>
                        
                        <!-- Premium Banner -->
                        <div id="premium-banner" class="card p-4 mt-4 bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-200 hidden">
                            <div class="flex items-center justify-center gap-4">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800">Premium Active</h3>
                                    <p class="text-sm text-gray-600">You have access to all premium features!</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="showPremiumModal()" class="btn-primary px-4 py-2 text-sm">
                                        Manage Subscription
                                    </button>
                                    <button onclick="cancelPremium()" class="btn-primary bg-red-500 hover:bg-red-600 px-4 py-2 text-sm">
                                        Cancel Premium
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Input Form -->
                    <div class="card p-6 mb-6">
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Ingredients:</label>
                            <div id="ingredients-container">
                                <div class="flex gap-2 mb-2">
                                    <input type="text" class="input-field flex-1" placeholder="Enter an ingredient..." id="ingredient-0">
                                    <button onclick="addIngredient()" class="btn-primary">+</button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Dietary Restrictions:</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" value="vegetarian"> Vegetarian
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" value="vegan"> Vegan
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" value="gluten-free"> Gluten-Free
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" value="dairy-free"> Dairy-Free
                                </label>
                            </div>
                        </div>

                        <!-- Premium Features -->
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Servings (Premium):</label>
                            <select id="servings-select" onchange="updateServings(this.value)" class="input-field">
                                <option value="2">2 servings</option>
                                <option value="4" selected>4 servings</option>
                                <option value="6">6 servings</option>
                                <option value="8">8 servings</option>
                                <option value="10">10 servings</option>
                                <option value="12">12 servings</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Cooking Time (Premium):</label>
                            <select id="time-select" onchange="updateCookingTime(this.value)" class="input-field">
                                <option value="any">Any time</option>
                                <option value="quick">Quick (15 min or less)</option>
                                <option value="medium">Medium (15-30 min)</option>
                                <option value="slow">Slow (30+ min)</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Cuisine Style (Premium):</label>
                            <select id="cuisine-select" onchange="updateCuisine(this.value)" class="input-field">
                                <option value="any">Any cuisine</option>
                                <option value="italian">Italian</option>
                                <option value="asian">Asian</option>
                                <option value="mexican">Mexican</option>
                                <option value="mediterranean">Mediterranean</option>
                                <option value="indian">Indian</option>
                                <option value="american">American</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Difficulty Level (Premium):</label>
                            <select id="difficulty-select" onchange="updateDifficulty(this.value)" class="input-field">
                                <option value="any">Any difficulty</option>
                                <option value="easy">Easy (Beginner)</option>
                                <option value="medium">Medium (Intermediate)</option>
                                <option value="hard">Hard (Advanced)</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Meal Planning (Premium):</label>
                            <div class="flex gap-2">
                                <button onclick="addToMealPlan('breakfast')" class="btn-primary text-sm px-3 py-1">Breakfast</button>
                                <button onclick="addToMealPlan('lunch')" class="btn-primary text-sm px-3 py-1">Lunch</button>
                                <button onclick="addToMealPlan('dinner')" class="btn-primary text-sm px-3 py-1">Dinner</button>
                                <button onclick="addToMealPlan('snack')" class="btn-primary text-sm px-3 py-1">Snack</button>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Recipe Collections (Premium):</label>
                            <div class="flex gap-2">
                                <button onclick="navigateToPage('saved-recipes')" class="btn-primary text-sm px-3 py-1">Saved Recipes</button>
                                <button onclick="navigateToPage('shopping-list')" class="btn-primary text-sm px-3 py-1">Shopping List</button>
                                <button onclick="navigateToPage('meal-plan')" class="btn-primary text-sm px-3 py-1">Meal Plan</button>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Smart Features (Premium):</label>
                            <div class="flex gap-2">
                                <button onclick="navigateToPage('cooking-tips')" class="btn-primary text-sm px-3 py-1">Cooking Tips</button>
                                <button onclick="navigateToPage('substitutions')" class="btn-primary text-sm px-3 py-1">Substitutions</button>
                                <button onclick="navigateToPage('wine-pairing')" class="btn-primary text-sm px-3 py-1">Wine Pairing</button>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Recipe Rating (Premium):</label>
                            <div class="flex gap-2">
                                <button onclick="rateRecipe(5)" class="text-2xl">‚òÖ</button>
                                <button onclick="rateRecipe(4)" class="text-2xl">‚òÖ</button>
                                <button onclick="rateRecipe(3)" class="text-2xl">‚òÖ</button>
                                <button onclick="rateRecipe(2)" class="text-2xl">‚òÖ</button>
                                <button onclick="rateRecipe(1)" class="text-2xl">‚òÖ</button>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Cooking Timer (Premium):</label>
                            <div class="flex gap-2">
                                <button onclick="startTimer(5)" class="btn-primary text-sm px-3 py-1">5 min</button>
                                <button onclick="startTimer(10)" class="btn-primary text-sm px-3 py-1">10 min</button>
                                <button onclick="startTimer(15)" class="btn-primary text-sm px-3 py-1">15 min</button>
                                <button onclick="startTimer(30)" class="btn-primary text-sm px-3 py-1">30 min</button>
                                <button onclick="customTimer()" class="btn-primary text-sm px-3 py-1">Custom</button>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Recipe History (Premium):</label>
                            <div class="flex gap-2">
                                <button onclick="navigateToPage('recipe-history')" class="btn-primary text-sm px-3 py-1">History</button>
                                <button onclick="navigateToPage('favorites')" class="btn-primary text-sm px-3 py-1">Favorites</button>
                                <button onclick="navigateToPage('timer')" class="btn-primary text-sm px-3 py-1">Timer</button>
                            </div>
                        </div>

                        <button onclick="generateRecipe()" class="btn-primary w-full py-3">
                            Generate Recipe
                        </button>
                    </div>

                    <!-- Recipe Display -->
                    <div id="recipe-display" class="hidden">
                        <div class="card p-8 recipe-card">
                            <h2 id="recipe-title" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                            <p id="recipe-description" class="text-gray-600 mb-6"></p>
                            
                            <div class="grid md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Ingredients:</h3>
                                    <ul id="recipe-ingredients" class="space-y-2"></ul>
                                </div>
                                <div>
                                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Instructions:</h3>
                                    <ol id="recipe-instructions" class="space-y-3"></ol>
                                </div>
                            </div>

                            <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                                <div class="flex items-center">
                                    <span class="font-semibold">Cooking Time:</span>
                                    <span id="cooking-time" class="ml-2"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-semibold">Servings:</span>
                                    <span id="servings" class="ml-2"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-semibold">Calories:</span>
                                    <span id="calories" class="ml-2"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Premium Modal -->
                    <div id="premium-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-3xl font-bold text-gray-800">Premium Features</h2>
                                <button onclick="hidePremiumModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                            </div>
                            
                            <!-- Premium Status Section -->
                            <div id="premium-status" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h3 class="text-lg font-bold text-green-800">Premium Active</h3>
                                        <p class="text-sm text-green-600">You have access to all premium features</p>
                                    </div>
                                    <button onclick="cancelPremium()" class="btn-primary bg-red-500 hover:bg-red-600 px-4 py-2 text-sm">
                                        Cancel Premium
                                    </button>
                                </div>
                            </div>
                            </div>
                            
                            <!-- Premium Plans -->
                            <div class="grid md:grid-cols-2 gap-6 mb-6">
                                <div class="border-2 border-gray-200 rounded-lg p-6 hover:border-pink-300 transition-colors">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Monthly Plan</h3>
                                    <div class="text-3xl font-bold text-pink-500 mb-2">$9.99<span class="text-lg text-gray-500">/month</span></div>
                                    <ul class="space-y-2 text-gray-600 mb-4">
                                        <li>‚úì Unlimited recipe generation</li>
                                        <li>‚úì Advanced dietary filters</li>
                                        <li>‚úì Recipe scaling (2-12 servings)</li>
                                        <li>‚úì Nutritional information</li>
                                        <li>‚úì Recipe collections</li>
                                        <li>‚úì Ad-free experience</li>
                                    </ul>
                                    <button onclick="selectPlan('monthly')" class="btn-primary w-full">Choose Monthly</button>
                                </div>
                                
                                <div class="border-2 border-pink-300 rounded-lg p-6 bg-pink-50 relative">
                                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-pink-500 text-white px-4 py-1 rounded-full text-sm font-bold">BEST VALUE</div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Yearly Plan</h3>
                                    <div class="text-3xl font-bold text-pink-500 mb-2">$79.99<span class="text-lg text-gray-500">/year</span></div>
                                    <div class="text-sm text-green-600 mb-2">Save 33% compared to monthly!</div>
                                    <ul class="space-y-2 text-gray-600 mb-4">
                                        <li>‚úì Everything in Monthly</li>
                                        <li>‚úì Meal planning tools</li>
                                        <li>‚úì Shopping list generator</li>
                                        <li>‚úì Recipe sharing</li>
                                        <li>‚úì Priority support</li>
                                        <li>‚úì Early access to new features</li>
                                    </ul>
                                    <button onclick="selectPlan('yearly')" class="btn-primary w-full">Choose Yearly</button>
                                </div>
                            </div>
                            
                            <!-- Payment Form -->
                            <div id="payment-form" class="hidden">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Payment Information</h3>
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Card Number</label>
                                        <input type="text" id="card-number" class="input-field" placeholder="1234 5678 9012 3456">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Expiry Date</label>
                                        <input type="text" id="card-expiry" class="input-field" placeholder="MM/YY">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">CVV</label>
                                        <input type="text" id="card-cvv" class="input-field" placeholder="123">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 font-semibold mb-2">Name on Card</label>
                                        <input type="text" id="card-name" class="input-field" placeholder="John Doe">
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="text-lg font-bold text-gray-800">
                                        Total: <span id="plan-price">$9.99</span>
                                    </div>
                                    <button onclick="processPayment()" class="btn-primary px-8 py-3">
                                        Pay Now
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Reset ingredient count
                ingredientCount = 1;
            } else {
                // If not premium, just reload
                location.reload();
            }
        }

        // Missing page functions
        function showWinePairingPage() {
            currentPage = 'wine-pairing';
            const mainContent = document.querySelector('.container');
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Wine Pairing Guide</h1>
                    <p class="text-gray-600">Expert wine recommendations for your dishes!</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Red Wines</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>Cabernet Sauvignon:</strong> Beef, lamb, aged cheese</li>
                            <li><strong>Pinot Noir:</strong> Chicken, salmon, mushrooms</li>
                            <li><strong>Merlot:</strong> Pork, pasta, soft cheese</li>
                            <li><strong>Syrah:</strong> Spicy dishes, grilled meats</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">White Wines</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>Chardonnay:</strong> Fish, chicken, creamy sauces</li>
                            <li><strong>Sauvignon Blanc:</strong> Seafood, goat cheese, herbs</li>
                            <li><strong>Pinot Grigio:</strong> Light pasta, salads, shellfish</li>
                            <li><strong>Riesling:</strong> Spicy food, Asian cuisine</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Sparkling & Dessert</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li><strong>Champagne:</strong> Appetizers, celebrations</li>
                            <li><strong>Prosecco:</strong> Light appetizers, brunch</li>
                            <li><strong>Port:</strong> Chocolate, blue cheese</li>
                            <li><strong>Sauternes:</strong> Foie gras, sweet desserts</li>
                        </ul>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">General Rules</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li>‚Ä¢ White wines with light dishes</li>
                            <li>‚Ä¢ Red wines with hearty dishes</li>
                            <li>‚Ä¢ Sparkling wines with appetizers</li>
                            <li>‚Ä¢ Sweet wines with desserts</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function showSavedRecipesPage() {
            currentPage = 'saved-recipes';
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            const mainContent = document.querySelector('.container');
            
            let recipesHtml = '';
            if (savedRecipes.length === 0) {
                recipesHtml = `
                    <div class="text-center text-gray-500 py-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-2">No saved recipes yet!</h3>
                        <p class="text-gray-500">Generate and save recipes to see them here.</p>
                    </div>
                `;
            } else {
                // Sort recipes by save date (newest first)
                savedRecipes.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
                
                savedRecipes.forEach((recipe, index) => {
                    const savedDate = new Date(recipe.savedAt).toLocaleDateString();
                    const ingredientsList = recipe.ingredients.map(ing => 
                        `<span class="ingredient-tag text-xs mr-1 mb-1">${ing.amount} ${ing.unit} ${ing.item}</span>`
                    ).join('');
                    
                    recipesHtml += `
                        <div class="card p-6 mb-4 hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">${recipe.title}</h3>
                                    <p class="text-gray-600 mb-3">${recipe.description}</p>
                                    
                                    <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-3">
                                        <div class="flex items-center">
                                            <span class="font-semibold">Time:</span>
                                            <span class="ml-1">${recipe.cookingTime}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="font-semibold">Servings:</span>
                                            <span class="ml-1">${recipe.servings}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="font-semibold">Calories:</span>
                                            <span class="ml-1">${recipe.calories}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <h4 class="font-semibold text-gray-700 mb-2">Ingredients:</h4>
                                        <div class="flex flex-wrap">
                                            ${ingredientsList}
                                        </div>
                                    </div>
                                    
                                    <p class="text-sm text-gray-500">Saved: ${savedDate}</p>
                                </div>
                                
                                <div class="flex flex-col gap-2 ml-4">
                                    <button onclick="viewRecipe('${recipe.title}')" class="btn-primary text-sm px-3 py-1">
                                        View Full
                                    </button>
                                    <button onclick="addIngredientsToShoppingList('${recipe.title}')" class="btn-primary text-sm px-3 py-1 bg-blue-500 hover:bg-blue-600">
                                        Add to Shopping List
                                    </button>
                                    <button onclick="removeRecipe('${recipe.title}')" class="btn-primary text-sm px-3 py-1 bg-red-500 hover:bg-red-600">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Saved Recipes</h1>
                    <p class="text-gray-600">Your personal recipe collection (${savedRecipes.length} recipes)</p>
                </div>
                ${recipesHtml}
            `;
        }

        function showShoppingListPage() {
            currentPage = 'shopping-list';
            const shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            const mainContent = document.querySelector('.container');
            
            let itemsHtml = '';
            if (shoppingList.length === 0) {
                itemsHtml = `
                    <div class="text-center text-gray-500 py-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-2">Shopping list is empty!</h3>
                        <p class="text-gray-500">Add ingredients from recipes to see them here.</p>
                    </div>
                `;
            } else {
                // Group items by recipe source
                const groupedItems = {};
                shoppingList.forEach(item => {
                    const source = item.fromRecipe || 'Manual';
                    if (!groupedItems[source]) {
                        groupedItems[source] = [];
                    }
                    groupedItems[source].push(item);
                });
                
                Object.entries(groupedItems).forEach(([source, items]) => {
                    itemsHtml += `
                        <div class="card p-4 mb-4">
                            <h3 class="font-bold text-gray-800 mb-3">${source}</h3>
                    `;
                    
                    items.forEach((item, index) => {
                        const globalIndex = shoppingList.findIndex(i => 
                            i.item === item.item && i.amount === item.amount && i.unit === item.unit
                        );
                        itemsHtml += `
                            <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                <div class="flex items-center">
                                    <span class="font-medium">${item.amount} ${item.unit} ${item.item}</span>
                                    ${item.fromRecipe ? `<span class="text-xs text-gray-500 ml-2">(from recipe)</span>` : ''}
                                </div>
                                <button onclick="removeFromShoppingList(${globalIndex})" class="btn-primary text-sm px-2 py-1 bg-red-500 hover:bg-red-600">
                                    Remove
                                </button>
                            </div>
                        `;
                    });
                    
                    itemsHtml += '</div>';
                });
            }
            
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Shopping List</h1>
                    <p class="text-gray-600">Your grocery shopping items (${shoppingList.length} items)</p>
                </div>
                ${itemsHtml}
            `;
        }

        function showMealPlanPage() {
            currentPage = 'meal-plan';
            const mealPlan = JSON.parse(localStorage.getItem('mealPlan') || '{}');
            const mainContent = document.querySelector('.container');
            
            let planHtml = '';
            const mealTypes = ['breakfast', 'lunch', 'dinner', 'snack'];
            let hasMeals = false;
            
            mealTypes.forEach(mealType => {
                if (mealPlan[mealType] && mealPlan[mealType].length > 0) {
                    hasMeals = true;
                    planHtml += `
                        <div class="card p-6 mb-4">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">${mealType.charAt(0).toUpperCase() + mealType.slice(1)}</h3>
                    `;
                    mealPlan[mealType].forEach(recipe => {
                        planHtml += `
                            <div class="mb-2 p-3 bg-gray-50 rounded">
                                <strong>${recipe.title}</strong>
                                <p class="text-sm text-gray-600">${recipe.description}</p>
                            </div>
                        `;
                    });
                    planHtml += '</div>';
                }
            });
            
            if (!hasMeals) {
                planHtml = '<div class="text-center text-gray-500">No meals planned yet!</div>';
            }
            
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Meal Plan</h1>
                    <p class="text-gray-600">Your weekly meal organization</p>
                </div>
                ${planHtml}
            `;
        }

        function showRecipeHistoryPage() {
            currentPage = 'recipe-history';
            const history = JSON.parse(localStorage.getItem('recipeHistory') || '[]');
            const mainContent = document.querySelector('.container');
            
            let historyHtml = '';
            if (history.length === 0) {
                historyHtml = '<div class="text-center text-gray-500">No recipe history yet!</div>';
            } else {
                history.slice(-10).reverse().forEach((recipe, index) => {
                    historyHtml += `
                        <div class="card p-4 mb-2">
                            <h3 class="font-bold text-gray-800">${recipe.title}</h3>
                            <p class="text-sm text-gray-500">Generated: ${new Date(recipe.date).toLocaleDateString()}</p>
                        </div>
                    `;
                });
            }
            
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Recipe History</h1>
                    <p class="text-gray-600">Your recent recipe generations</p>
                </div>
                ${historyHtml}
            `;
        }

        function showFavoritesPage() {
            currentPage = 'favorites';
            const ratings = JSON.parse(localStorage.getItem('recipeRatings') || '{}');
            const favorites = Object.entries(ratings).filter(([title, data]) => data.rating >= 4);
            const mainContent = document.querySelector('.container');
            
            let favoritesHtml = '';
            if (favorites.length === 0) {
                favoritesHtml = '<div class="text-center text-gray-500">No favorite recipes yet!</div>';
            } else {
                favorites.forEach(([title, data]) => {
                    favoritesHtml += `
                        <div class="card p-4 mb-2">
                            <h3 class="font-bold text-gray-800">${title}</h3>
                            <p class="text-sm text-gray-500">Rated: ${'‚òÖ'.repeat(data.rating)} (${data.rating}/5)</p>
                        </div>
                    `;
                });
            }
            
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Favorite Recipes</h1>
                    <p class="text-gray-600">Your highest rated recipes</p>
                </div>
                ${favoritesHtml}
            `;
        }

        function showTimerPage() {
            currentPage = 'timer';
            const mainContent = document.querySelector('.container');
            mainContent.innerHTML = `
                <div class="text-center mb-8">
                    <button onclick="goBack()" class="btn-primary mb-4">‚Üê Back to Recipe Generator</button>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Cooking Timer</h1>
                    <p class="text-gray-600">Set timers for your cooking steps</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Quick Timers</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="startTimer(5)" class="btn-primary">5 min</button>
                            <button onclick="startTimer(10)" class="btn-primary">10 min</button>
                            <button onclick="startTimer(15)" class="btn-primary">15 min</button>
                            <button onclick="startTimer(30)" class="btn-primary">30 min</button>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Custom Timer</h3>
                        <input type="number" id="custom-timer" placeholder="Enter minutes" class="input-field mb-4">
                        <button onclick="startCustomTimer()" class="btn-primary w-full">Start Custom Timer</button>
                    </div>
                </div>
            `;
        }

        function startCustomTimer() {
            const minutes = document.getElementById('custom-timer').value;
            if (minutes && !isNaN(minutes)) {
                startTimer(parseInt(minutes));
            }
        }

        function removeFromShoppingList(index) {
            const shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            shoppingList.splice(index, 1);
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            showShoppingListPage();
        }

        // Enhanced recipe generation with history tracking
        function generateRecipe() {
            const ingredients = [];
            for (let i = 0; i < ingredientCount; i++) {
                const input = document.getElementById(`ingredient-${i}`);
                if (input && input.value.trim()) {
                    ingredients.push(input.value.trim());
                }
            }

            if (ingredients.length === 0) {
                alert('Please add at least one ingredient!');
                return;
            }

            // Get dietary restrictions
            const restrictions = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                restrictions.push(cb.value);
            });

            // Generate recipe based on ingredients
            const recipe = generateRecipeFromIngredients(ingredients, restrictions);
            
            // Track recipe in history
            const history = JSON.parse(localStorage.getItem('recipeHistory') || '[]');
            history.push({
                ...recipe,
                date: new Date().toISOString(),
                ingredients: ingredients
            });
            localStorage.setItem('recipeHistory', JSON.stringify(history));
            
            displayRecipe(recipe);
        }

        // Smart features functions
        function showCookingTips() {
            const tips = [
                "üî™ Always sharpen your knives before cooking for cleaner cuts",
                "üå°Ô∏è Let meat rest for 5-10 minutes after cooking for juicier results",
                "üßÇ Season in layers - add salt throughout the cooking process",
                "üî• Preheat your pan before adding ingredients for better searing",
                "üßÑ Mince garlic finely for stronger flavor, chop coarsely for milder taste",
                "ü•ò Use a wooden spoon for stirring to avoid scratching non-stick pans",
                "üåø Add fresh herbs at the end of cooking to preserve their flavor",
                "üíß Keep a bowl of water nearby to test if oil is hot enough (should sizzle)",
                "üìè Use a meat thermometer for perfectly cooked proteins",
                "ü•Ñ Taste as you cook and adjust seasoning gradually"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            alert(`üí° Cooking Tip:\n\n${randomTip}`);
        }

        function showSubstitutions() {
            const substitutions = {
                "butter": "Olive oil, coconut oil, or applesauce (for baking)",
                "eggs": "Flax seeds + water, mashed banana, or commercial egg replacer",
                "milk": "Almond milk, soy milk, oat milk, or coconut milk",
                "flour": "Almond flour, coconut flour, or gluten-free flour blend",
                "sugar": "Honey, maple syrup, stevia, or coconut sugar",
                "salt": "Herbs, spices, or lemon juice for flavor",
                "garlic": "Garlic powder, shallots, or onion",
                "onion": "Shallots, leeks, or green onions",
                "tomato sauce": "Crushed tomatoes, tomato paste + water, or fresh tomatoes",
                "cream": "Coconut milk, cashew cream, or Greek yogurt"
            };
            
            let subText = "üîÑ Common Ingredient Substitutions:\n\n";
            Object.entries(substitutions).forEach(([ingredient, sub]) => {
                subText += `${ingredient}: ${sub}\n\n`;
            });
            
            alert(subText);
        }

        function showWinePairing() {
            const winePairings = {
                "chicken": "üç∑ Chardonnay, Pinot Grigio, or Sauvignon Blanc",
                "beef": "üç∑ Cabernet Sauvignon, Merlot, or Malbec",
                "salmon": "üç∑ Pinot Noir, Chardonnay, or Riesling",
                "pasta": "üç∑ Chianti, Pinot Grigio, or Barbera",
                "seafood": "üç∑ Sauvignon Blanc, Pinot Grigio, or Albari√±o",
                "pork": "üç∑ Pinot Noir, Chardonnay, or Riesling",
                "lamb": "üç∑ Cabernet Sauvignon, Syrah, or Bordeaux",
                "vegetarian": "üç∑ Pinot Noir, Chardonnay, or Sauvignon Blanc",
                "spicy": "üç∑ Riesling, Gew√ºrztraminer, or Moscato",
                "dessert": "üç∑ Port, Sauternes, or Ice Wine"
            };
            
            const currentRecipe = getCurrentRecipe();
            let pairing = "üç∑ Wine Pairing Suggestions:\n\n";
            
            if (currentRecipe) {
                const title = currentRecipe.title.toLowerCase();
                let found = false;
                
                Object.entries(winePairings).forEach(([food, wine]) => {
                    if (title.includes(food)) {
                        pairing += `For ${currentRecipe.title}:\n${wine}\n\n`;
                        found = true;
                    }
                });
                
                if (!found) {
                    pairing += "General pairing tips:\n‚Ä¢ White wines with light dishes\n‚Ä¢ Red wines with hearty dishes\n‚Ä¢ Sparkling wines with appetizers\n‚Ä¢ Sweet wines with desserts";
                }
            } else {
                pairing += "Generate a recipe first to get specific wine pairing suggestions!";
            }
            
            alert(pairing);
        }

        function createMultiIngredientRecipe(ingredients, restrictions) {
            const mainIngredient = ingredients[0];
            const secondaryIngredients = ingredients.slice(1);
            
            let recipeTitle, description, additionalIngredients, instructions, calories;
            
            // Determine recipe type based on ingredients
            const hasProtein = ingredients.some(i => ['chicken', 'beef', 'pork', 'fish', 'salmon', 'tuna', 'shrimp', 'tofu'].includes(i.toLowerCase()));
            const hasVegetables = ingredients.some(i => ['carrot', 'broccoli', 'spinach', 'tomato', 'onion', 'pepper', 'mushroom', 'zucchini'].includes(i.toLowerCase()));
            const hasGrains = ingredients.some(i => ['rice', 'pasta', 'quinoa', 'bread'].includes(i.toLowerCase()));
            
            if (hasProtein && hasVegetables) {
                recipeTitle = `${mainIngredient} Stir-Fry with ${secondaryIngredients.join(', ')}`;
                description = `A delicious stir-fry combining your ingredients with Asian flavors`;
                additionalIngredients = [
                    { item: mainIngredient, amount: '1', unit: 'pound' },
                    ...secondaryIngredients.map(ing => ({ item: ing, amount: '1', unit: 'cup' })),
                    { item: 'soy sauce', amount: '3', unit: 'tablespoons' },
                    { item: 'sesame oil', amount: '1', unit: 'tablespoon' },
                    { item: 'garlic', amount: '3', unit: 'cloves' },
                    { item: 'ginger', amount: '1', unit: 'tablespoon' },
                    { item: 'vegetable oil', amount: '2', unit: 'tablespoons' }
                ];
                instructions = [
                    'Heat vegetable oil in a large wok or skillet over high heat',
                    'Add minced garlic and ginger, cook for 30 seconds',
                    `Add ${mainIngredient} and stir-fry for 3-4 minutes`,
                    `Add ${secondaryIngredients.join(', ')} and continue cooking for 2-3 minutes`,
                    'Add soy sauce and sesame oil, cook for 1 minute',
                    'Serve hot with steamed rice'
                ];
                calories = '320 calories per serving';
            } else if (hasGrains && hasVegetables) {
                recipeTitle = `${mainIngredient} Bowl with ${secondaryIngredients.join(', ')}`;
                description = `A healthy grain bowl featuring your ingredients`;
                additionalIngredients = [
                    { item: mainIngredient, amount: '2', unit: 'cups' },
                    ...secondaryIngredients.map(ing => ({ item: ing, amount: '1', unit: 'cup' })),
                    { item: 'olive oil', amount: '2', unit: 'tablespoons' },
                    { item: 'lemon', amount: '1', unit: 'whole' },
                    { item: 'garlic', amount: '2', unit: 'cloves' },
                    { item: 'fresh herbs', amount: '2', unit: 'tablespoons' },
                    { item: 'salt and pepper', amount: 'to taste', unit: '' }
                ];
                instructions = [
                    'Cook grains according to package directions',
                    'Meanwhile, prepare vegetables and chop herbs',
                    'Heat olive oil in a large skillet over medium heat',
                    'Add garlic and cook for 1 minute until fragrant',
                    `Add ${secondaryIngredients.join(', ')} and cook for 3-4 minutes`,
                    'Combine with cooked grains and fresh herbs',
                    'Squeeze lemon juice over and season to taste'
                ];
                calories = '280 calories per serving';
            } else {
                recipeTitle = `${mainIngredient} and ${secondaryIngredients.join(', ')} Medley`;
                description = `A flavorful dish combining all your ingredients`;
                additionalIngredients = [
                    { item: mainIngredient, amount: '2', unit: 'cups' },
                    ...secondaryIngredients.map(ing => ({ item: ing, amount: '1', unit: 'cup' })),
                    { item: 'olive oil', amount: '3', unit: 'tablespoons' },
                    { item: 'garlic', amount: '3', unit: 'cloves' },
                    { item: 'fresh herbs', amount: '2', unit: 'tablespoons' },
                    { item: 'lemon', amount: '1', unit: 'whole' },
                    { item: 'salt and pepper', amount: 'to taste', unit: '' }
                ];
                instructions = [
                    'Heat olive oil in a large skillet over medium heat',
                    'Add minced garlic and cook for 1 minute until fragrant',
                    `Add ${mainIngredient} and cook for 3-4 minutes`,
                    `Add ${secondaryIngredients.join(', ')} and continue cooking for 2-3 minutes`,
                    'Add fresh herbs and squeeze lemon juice over',
                    'Season with salt and pepper to taste',
                    'Serve hot as a side dish or over rice'
                ];
                calories = '250 calories per serving';
            }
            
            return {
                title: recipeTitle,
                description: description,
                ingredients: additionalIngredients,
                instructions: instructions,
                cookingTime: '25 minutes',
                servings: '4 servings',
                calories: calories
            };
        }

        function rateRecipe(rating) {
            const currentRecipe = getCurrentRecipe();
            if (!currentRecipe) {
                alert('Please generate a recipe first!');
                return;
            }
            
            const ratings = JSON.parse(localStorage.getItem('recipeRatings') || '{}');
            ratings[currentRecipe.title] = {
                rating: rating,
                date: new Date().toISOString()
            };
            
            localStorage.setItem('recipeRatings', JSON.stringify(ratings));
            
            const stars = '‚≠ê'.repeat(rating);
            alert(`Rated "${currentRecipe.title}" ${stars} (${rating}/5 stars)`);
        }

        // Meal planning functions
        function addToMealPlan(mealType) {
            const currentRecipe = getCurrentRecipe();
            if (!currentRecipe) {
                alert('Please generate a recipe first!');
                return;
            }
            
            const mealPlan = JSON.parse(localStorage.getItem('mealPlan') || '{}');
            if (!mealPlan[mealType]) {
                mealPlan[mealType] = [];
            }
            
            mealPlan[mealType].push({
                ...currentRecipe,
                addedAt: new Date().toISOString()
            });
            
            localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
            alert(`Added to ${mealType} meal plan!`);
        }

        function getCurrentRecipe() {
            const title = document.getElementById('recipe-title')?.textContent;
            const description = document.getElementById('recipe-description')?.textContent;
            
            if (!title) return null;
            
            return {
                title: title,
                description: description,
                ingredients: [], // Would need to parse from DOM
                instructions: [], // Would need to parse from DOM
                cookingTime: document.getElementById('cooking-time')?.textContent || '',
                servings: document.getElementById('servings')?.textContent || '',
                calories: document.getElementById('calories')?.textContent || ''
            };
        }

        function viewSavedRecipes() {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            if (savedRecipes.length === 0) {
                alert('No saved recipes yet! Save a recipe to see it here.');
                return;
            }
            
            const recipeList = savedRecipes.map(recipe => 
                `üìñ ${recipe.title} (saved ${new Date(recipe.savedAt).toLocaleDateString()})`
            ).join('\n');
            
            alert(`Saved Recipes:\n\n${recipeList}`);
        }

        function viewShoppingList() {
            const shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            if (shoppingList.length === 0) {
                alert('Shopping list is empty! Add ingredients from recipes to see them here.');
                return;
            }
            
            const itemList = shoppingList.map(item => 
                `üõí ${item.amount} ${item.unit} ${item.item}`
            ).join('\n');
            
            alert(`Shopping List:\n\n${itemList}`);
        }

        function viewMealPlan() {
            const mealPlan = JSON.parse(localStorage.getItem('mealPlan') || '{}');
            let planText = 'üìÖ Your Meal Plan:\n\n';
            
            const mealTypes = ['breakfast', 'lunch', 'dinner', 'snack'];
            let hasMeals = false;
            
            mealTypes.forEach(mealType => {
                if (mealPlan[mealType] && mealPlan[mealType].length > 0) {
                    hasMeals = true;
                    planText += `${mealType.toUpperCase()}:\n`;
                    mealPlan[mealType].forEach(recipe => {
                        planText += `  üç≥ ${recipe.title}\n`;
                    });
                    planText += '\n';
                }
            });
            
            if (!hasMeals) {
                planText = 'No meals planned yet! Add recipes to your meal plan.';
            }
            
            alert(planText);
        }

        function updateServings(value) {
            servings = parseInt(value);
        }

        function updateCookingTime(value) {
            localStorage.setItem('cookingTime', value);
        }

        function updateCuisine(value) {
            localStorage.setItem('cuisine', value);
        }

        function updateDifficulty(value) {
            localStorage.setItem('difficulty', value);
        }

        // Enhanced recipe display with premium features
        function displayRecipe(recipe) {
            document.getElementById('recipe-title').textContent = recipe.title;
            document.getElementById('recipe-description').textContent = recipe.description;
            
            // Display ingredients (scale for premium users)
            const ingredientsList = document.getElementById('recipe-ingredients');
            ingredientsList.innerHTML = '';
            recipe.ingredients.forEach(ingredient => {
                const li = document.createElement('li');
                li.className = 'flex items-center';
                let amount = ingredient.amount;
                let unit = ingredient.unit;
                
                // Scale ingredients for premium users
                if (isPremium && servings !== 4) {
                    const originalAmount = parseFloat(amount);
                    const scaleFactor = servings / 4;
                    amount = (originalAmount * scaleFactor).toFixed(1);
                    if (amount.endsWith('.0')) amount = amount.slice(0, -2);
                }
                
                li.innerHTML = `
                    <span class="ingredient-tag mr-2">${amount} ${unit}</span>
                    <span class="text-gray-700">${ingredient.item}</span>
                `;
                ingredientsList.appendChild(li);
            });

            // Display instructions
            const instructionsList = document.getElementById('recipe-instructions');
            instructionsList.innerHTML = '';
            recipe.instructions.forEach((instruction, index) => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-3';
                li.innerHTML = `
                    <div class="step-number">${index + 1}</div>
                    <span class="text-gray-700">${instruction}</span>
                `;
                instructionsList.appendChild(li);
            });

            // Display cooking info with premium enhancements
            document.getElementById('cooking-time').textContent = recipe.cookingTime;
            document.getElementById('servings').textContent = isPremium ? `${servings} servings` : recipe.servings;
            document.getElementById('calories').textContent = recipe.calories;

            // Add premium features to recipe display
            if (isPremium) {
                addPremiumRecipeFeatures(recipe);
            }

            // Add save recipe button for all users
            addSaveRecipeButton(recipe);

            // Show the recipe
            document.getElementById('recipe-display').classList.remove('hidden');
            document.getElementById('recipe-display').scrollIntoView({ behavior: 'smooth' });
        }

        function addSaveRecipeButton(recipe) {
            const recipeCard = document.querySelector('.recipe-card');
            
            // Check if save button already exists
            const existingSaveBtn = recipeCard.querySelector('.save-recipe-btn');
            if (existingSaveBtn) {
                existingSaveBtn.remove();
            }
            
            // Create save button
            const saveButton = document.createElement('button');
            saveButton.className = 'save-recipe-btn btn-primary mt-4 px-6 py-2';
            saveButton.innerHTML = 'Save Recipe';
            saveButton.onclick = () => saveRecipe(recipe);
            
            // Add to recipe card
            recipeCard.appendChild(saveButton);
        }

        function saveRecipe(recipe) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            
            // Check if recipe is already saved
            const existingIndex = savedRecipes.findIndex(saved => saved.title === recipe.title);
            
            if (existingIndex !== -1) {
                if (confirm('This recipe is already saved. Do you want to update it?')) {
                    savedRecipes[existingIndex] = {
                        ...recipe,
                        savedAt: new Date().toISOString(),
                        lastModified: new Date().toISOString()
                    };
                } else {
                    return;
                }
            } else {
                // Add new recipe
                savedRecipes.push({
                    ...recipe,
                    savedAt: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                });
            }
            
            localStorage.setItem('savedRecipes', JSON.stringify(savedRecipes));
            alert('Recipe saved successfully!');
            
            // Update button text
            const saveBtn = document.querySelector('.save-recipe-btn');
            if (saveBtn) {
                saveBtn.innerHTML = 'Saved!';
                saveBtn.disabled = true;
                setTimeout(() => {
                    saveBtn.innerHTML = 'Save Recipe';
                    saveBtn.disabled = false;
                }, 2000);
            }
        }

        function addPremiumRecipeFeatures(recipe) {
            const recipeCard = document.querySelector('.recipe-card');
            
            // Add save recipe button
            const saveButton = document.createElement('button');
            saveButton.className = 'btn-primary mt-4 mr-2';
            saveButton.innerHTML = 'Save Recipe';
            saveButton.onclick = () => saveRecipe(recipe);
            
            // Add share recipe button
            const shareButton = document.createElement('button');
            shareButton.className = 'btn-primary mt-4 mr-2';
            shareButton.innerHTML = 'Share Recipe';
            shareButton.onclick = () => shareRecipe(recipe);
            
            // Add shopping list button
            const shoppingButton = document.createElement('button');
            shoppingButton.className = 'btn-primary mt-4';
            shoppingButton.innerHTML = 'Add to Shopping List';
            shoppingButton.onclick = () => addToShoppingList(recipe);
            
            // Add buttons to recipe card
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'flex flex-wrap gap-2 mt-6';
            buttonContainer.appendChild(saveButton);
            buttonContainer.appendChild(shareButton);
            buttonContainer.appendChild(shoppingButton);
            
            recipeCard.appendChild(buttonContainer);
            
            // Add nutritional breakdown for premium users
            addNutritionalInfo(recipe);
        }



        function shareRecipe(recipe) {
            const recipeText = `
${recipe.title}

${recipe.description}

Ingredients:
${recipe.ingredients.map(i => `- ${i.amount} ${i.unit} ${i.item}`).join('\n')}

Instructions:
${recipe.instructions.map((step, i) => `${i + 1}. ${step}`).join('\n')}

Cooking Time: ${recipe.cookingTime}
Servings: ${recipe.servings}
Calories: ${recipe.calories}

Shared from Recipe Generator App
            `;
            
            if (navigator.share) {
                navigator.share({
                    title: recipe.title,
                    text: recipeText
                });
            } else {
                navigator.clipboard.writeText(recipeText);
                alert('Recipe copied to clipboard!');
            }
        }

        function addToShoppingList(recipe) {
            const shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            recipe.ingredients.forEach(ingredient => {
                shoppingList.push({
                    item: ingredient.item,
                    amount: ingredient.amount,
                    unit: ingredient.unit,
                    addedAt: new Date().toISOString()
                });
            });
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            alert('Ingredients added to shopping list!');
        }

        function addNutritionalInfo(recipe) {
            const nutritionDiv = document.createElement('div');
            nutritionDiv.className = 'mt-6 p-4 bg-pink-50 rounded-lg';
            nutritionDiv.innerHTML = `
                <h4 class="text-lg font-bold text-gray-800 mb-3">Nutritional Information (Premium)</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div class="text-center">
                        <div class="font-bold text-pink-600">${recipe.calories}</div>
                        <div class="text-gray-600">Calories</div>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-pink-600">12g</div>
                        <div class="text-gray-600">Protein</div>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-pink-600">8g</div>
                        <div class="text-gray-600">Fat</div>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-pink-600">45g</div>
                        <div class="text-gray-600">Carbs</div>
                    </div>
                </div>
            `;
            
            const recipeCard = document.querySelector('.recipe-card');
            recipeCard.appendChild(nutritionDiv);
        }

        function viewRecipe(recipeTitle) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            const recipe = savedRecipes.find(r => r.title === recipeTitle);
            
            if (!recipe) {
                alert('Recipe not found!');
                return;
            }
            
            // Go back to main page first
            showMainPage();
            
            // Wait a moment for the page to load, then display the recipe
            setTimeout(() => {
                displayRecipe(recipe);
            }, 100);
        }

        function addIngredientsToShoppingList(recipeTitle) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            const recipe = savedRecipes.find(r => r.title === recipeTitle);
            
            if (!recipe) {
                alert('Recipe not found!');
                return;
            }
            
            const shoppingList = JSON.parse(localStorage.getItem('shoppingList') || '[]');
            
            // Add all ingredients from the recipe
            recipe.ingredients.forEach(ingredient => {
                // Check if ingredient already exists
                const existingIndex = shoppingList.findIndex(item => 
                    item.item.toLowerCase() === ingredient.item.toLowerCase()
                );
                
                if (existingIndex !== -1) {
                    // Update quantity if ingredient exists
                    const existing = shoppingList[existingIndex];
                    const existingAmount = parseFloat(existing.amount);
                    const newAmount = parseFloat(ingredient.amount);
                    shoppingList[existingIndex].amount = (existingAmount + newAmount).toString();
                } else {
                    // Add new ingredient
                    shoppingList.push({
                        item: ingredient.item,
                        amount: ingredient.amount,
                        unit: ingredient.unit,
                        fromRecipe: recipe.title
                    });
                }
            });
            
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            alert(`Added ${recipe.ingredients.length} ingredients from "${recipe.title}" to your shopping list!`);
        }

        function removeRecipe(recipeTitle) {
            const savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            const recipeIndex = savedRecipes.findIndex(r => r.title === recipeTitle);
            
            if (recipeIndex === -1) {
                alert('Recipe not found!');
                return;
            }
            
            if (confirm(`Are you sure you want to delete "${recipeTitle}" from your saved recipes?`)) {
                savedRecipes.splice(recipeIndex, 1);
                localStorage.setItem('savedRecipes', JSON.stringify(savedRecipes));
                
                // Refresh the saved recipes page
                showSavedRecipesPage();
                
                alert('Recipe deleted successfully!');
            }
        }
    </script>
</body>
</html> 